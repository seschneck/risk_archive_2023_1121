---
title: "Supplemental Analyses"
author: "Kendra Wyant"
date: '`r format(Sys.time(), "%Y-%m-%d")`'
output: 
  html_document
knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_dir = dplyr::if_else(Sys.info()[["sysname"]] == "Windows",
      "P:/studydata/risk/knits/burden", 
      "/Volumes/private/studydata/risk/knits/burden")
    )
  })
---

Purpose: These are the supplemental figures, tables, and analyses for *Acceptability of Personal Sensing among People with Alcohol Use Disorder*.  


```{r setup, include = FALSE}
knitr::opts_chunk$set(message = FALSE, warning = TRUE, echo = FALSE)
options(knitr.kable.NA = '')
```


```{r}
path_burden <- "P:/studydata/risk/data_processed/burden"
path_data <- "P:/studydata/risk/data_processed/shared"
```

```{r, message = FALSE, warning = FALSE}
library(tidyverse)
library(kableExtra)
library(ggtext)
library(cowplot)
library(patchwork)
library(rstatix)
library(janitor)

theme_set(theme_bw())
```

<br>


```{r warning = FALSE, fig.height=6, fig.width=8}
burden <- read_csv(file.path(path_burden, "burden.csv"), col_types = cols())

burden_time <- burden %>% 
  select(-contains("wristband")) %>% 
  group_by(subid) %>% 
  mutate(n_obs = n()) %>% 
  filter(n_obs == 3) %>% 
  # create time variable
  arrange(date) %>%
  mutate(time = row_number()) %>% 
  ungroup()


dislike <- burden_time %>% 
  select(contains("dislike")) %>% 
  pivot_longer(everything(), "measure")
interfere <- burden_time %>% 
  select(contains("interfere")) %>% 
  pivot_longer(everything(), "measure")
oneyear <- burden_time %>% 
  select(contains("1year")) %>% 
  pivot_longer(everything(), "measure")
logs <- burden_time %>% 
  select(contains("all_logs")) %>% 
  pivot_longer(everything(), "measure")
sleep <- burden_time %>% 
  select(contains("sleep")) %>% 
  keep(~is.numeric(.x)) %>% 
  pivot_longer(everything(), "measure")
audio <- burden_time %>% 
  select(contains("audio")) %>% 
  keep(~is.numeric(.x)) %>% 
  pivot_longer(everything(), "measure")
# daily_1 <- burden_time %>% 
#   select(contains("daily_survey_1")) %>% 
#   keep(~is.numeric(.x)) %>% 
#   pivot_longer(everything(), "measure")
daily_4 <- burden_time %>% 
  select(contains("daily_survey"), -daily_survey_1_1year) %>% 
  keep(~is.numeric(.x)) %>% 
  pivot_longer(everything(), "measure")
location <- burden_time %>% 
  select(contains("location")) %>% 
  keep(~is.numeric(.x)) %>% 
  pivot_longer(everything(), "measure")
sms <- burden_time %>% 
  select(contains("sms")) %>% 
  keep(~is.numeric(.x)) %>% 
  pivot_longer(everything(), "measure")
# carry_phone <- burden_time %>% 
#   select(contains("carrying_phone")) %>% 
#   keep(~is.numeric(.x)) %>% 
#   pivot_longer(everything(), "measure")

burden_time_plot <- burden_time %>% 
  select(time,
         contains("interfere"),
         contains("dislike"),
         contains("1year")) %>% 
  pivot_longer(sleep_interfere:all_logs_1year, "measure") %>% 
  mutate(burden = case_when(measure %in% dislike$measure ~ "Dislike",
                            measure %in% interfere$measure ~ "Interference",
                            measure %in% oneyear$measure ~ "Willingness to Continue"),
         burden = factor(burden, levels = c("Interference", "Dislike", "Willingness to Continue"))) %>% 
  mutate(measure = case_when(measure %in% logs$measure ~ "Cellular Communication Logs",
                                  measure %in% sleep$measure ~ "Sleep Quality",
                                  measure %in% audio$measure ~ "Audio Check-in",
                                  measure %in% daily_4$measure ~ "Ecological Momentary Assessment",
                                  measure %in% location$measure ~ "Moment-by-Moment Geolocation",
                                  measure %in% sms$measure ~ "Text Message Content")) 

burden_time_plot %>% 
  group_by(measure, time, burden) %>% 
  # missing values due to two participants who didn't complete survey at time point 2
  summarise(mean = mean(value, na.rm = TRUE)) %>% 
  ggplot(aes(x = time, y = mean, group = measure, color = measure)) +
  geom_point() +
  geom_line() +
  facet_wrap(~burden) +
  theme_classic() +
  scale_color_manual(values = c("dodgerblue4",  "skyblue3", "azure3", 
                                "thistle1", "thistle3", "plum4")) +
  scale_x_continuous(name = "Time Point", 
                     breaks = c(1, 2, 3)) +
  scale_y_continuous(name = "Mean Score", 
                     breaks = c(-2, -1, 0, 1, 2), 
                     limits = c(-2, 2)) +
  labs(title = "Figure S1<br><br>Acceptability over time by personal sensing method",
       caption = "<i>Note:</i>  Participant ratings (<i>N</i> = 133) for each measure of acceptability at three different time points one-month <br>apart. Sleep monitoring N = 87. Each measure is on a 5-point bipolar scale anchored around a neutral/<br>ambivalent response of 0 (i.e., undecided) with higher values representing higher acceptability. Dashed line <br>represents neutral score.") +
  theme(legend.title = element_blank(),
        legend.text = element_markdown(),
        plot.caption = element_markdown(hjust = 0, size = 10, lineheight = 1.25),
        text = element_text(),
        plot.title = element_markdown(),
        plot.subtitle = element_markdown(size = 12, lineheight = 1.25)) +
  geom_hline(aes(yintercept = 0), linetype = "dashed", size = .3)
```

<br>


```{r fig.height = 6}
burden_wrist <- read_csv(file.path(path_burden, "burden.csv"), col_types = cols()) %>% 
  select(c(subid, date, contains("wristband"))) 

wristband_descr <- burden_wrist %>% 
  filter(!is.na(wristband_interfere)) %>%
  group_by(subid) %>% 
  arrange(desc(date)) %>% 
  slice(1) %>% 
  ungroup() %>% 
  select("Interference" = wristband_interfere, 
         "Dislike" = wristband_dislike, 
         "Willingness to Continue" = wristband_1year) %>% 
  gather(key = "measure")

wrist_int <- wristband_descr %>% 
  filter(measure == "Interference") %>% 
  mutate(value = factor(value, levels = c(-2:2),
                        labels = c("Strongly agree", "Agree", "Undecided", "Disagree", "Strongly disagree"))) %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "#FFDEDE") +
  facet_wrap(~measure) +
  theme_classic() +
  ylim(0, .7) +
  labs(y = "Proportion",
       x = NULL) +
  scale_x_discrete(drop=FALSE) +
    theme(legend.position = "none",
        text = element_text(),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  geom_vline(aes(xintercept = mean(as.numeric(value))), linetype = "solid", size = .4, color = "#787575") +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4)

wrist_dis <- wristband_descr %>% 
  filter(measure == "Dislike") %>% 
  mutate(value = factor(value, levels = c(-2:2),
                        labels = c("Strongly agree", "Agree", "Undecided", "Disagree", "Strongly disagree"))) %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "#FFDEDE") +
  facet_wrap(~measure) +
  theme_classic() +
  ylim(0, .7) +
  labs(y = NULL,
       x = NULL) +
    theme(legend.position = "none",
        text = element_text(),
        axis.text.y =element_blank(),
        axis.ticks.y=element_blank(),
        axis.line.y = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  geom_vline(aes(xintercept = mean(as.numeric(value))), linetype = "solid", size = .4, color = "#787575") +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4)

wrist_1yr <- wristband_descr %>% 
  filter(measure == "Willingness to Continue") %>% 
  mutate(value = factor(value, levels = c(-2:2),
                        labels = c("Strongly disagree", "Disagree", "Undecided", "Agree", "Strongly agree"))) %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "#FFDEDE") +
  facet_wrap(~measure) +
  theme_classic() +
  ylim(0, .7) +
  labs(y = NULL,
       x = NULL) +
    theme(legend.position = "none",
        text = element_text(),
        axis.text.y=element_blank(),
        axis.line.y = element_blank(),
        axis.ticks.y=element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  geom_vline(aes(xintercept = mean(as.numeric(value))), linetype = "solid", size = .4, color = "#787575") +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4)


p_wrist <- wrap_plots(wrist_int, wrist_dis, wrist_1yr) 
p_wrist +
 plot_annotation(
   title = "Figure S2<br><br> Physiology Wristband Acceptability",
  caption =  "<i>Note:</i> Sample size is 9. Solid line represents the mean and dashed line represents the neutral/ambivalent <br>score.</i>"
) &
  theme(plot.caption = element_markdown(hjust = 0, size = 10, lineheight = 1),
        text = element_text(),
        plot.title = element_markdown(size = 12),
        plot.subtitle = element_markdown(size = 12))
```


<br>

```{r}
burden_phone <- read_csv(file.path(path_burden, "burden.csv"), col_types = cols()) %>% 
  select(c(subid, date, contains("carrying_phone"))) 

phone_descr <- burden_phone %>% 
  filter(!is.na(carrying_phone_interfere)) %>%
  group_by(subid) %>% 
  arrange(desc(date)) %>% 
  slice(1) %>% 
  ungroup() %>% 
  select("Interference" = carrying_phone_interfere, 
         "Dislike" = carrying_phone_dislike, 
         "Willingness to Continue" = carrying_phone_1year) %>% 
  gather(key = "measure")

phone_int <- phone_descr %>% 
  filter(measure == "Interference") %>% 
  mutate(value = factor(value, levels = c(-2:2),
                        labels = c("Strongly agree", "Agree", "Undecided", "Disagree", "Strongly disagree"))) %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "#FFDEDE") +
  facet_wrap(~measure) +
  theme_classic() +
  ylim(0, .7) +
  labs(y = "Proportion",
       x = NULL) +
  scale_x_discrete(drop=FALSE) +
    theme(legend.position = "none",
        text = element_text(),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  geom_vline(aes(xintercept = mean(as.numeric(value))), linetype = "solid", size = .4, color = "#787575") +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4)

phone_dis <- phone_descr %>% 
  filter(measure == "Dislike") %>% 
  mutate(value = factor(value, levels = c(-2:2),
                        labels = c("Strongly agree", "Agree", "Undecided", "Disagree", "Strongly disagree"))) %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "#FFDEDE") +
  facet_wrap(~measure) +
  theme_classic() +
  ylim(0, .7) +
  labs(y = NULL,
       x = NULL) +
    theme(legend.position = "none",
        text = element_text(),
        axis.text.y =element_blank(),
        axis.ticks.y=element_blank(),
        axis.line.y = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  geom_vline(aes(xintercept = mean(as.numeric(value))), linetype = "solid", size = .4, color = "#787575") +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4)

phone_1yr <- phone_descr %>% 
  filter(measure == "Willingness to Continue") %>% 
  mutate(value = factor(value, levels = c(-2:2),
                        labels = c("Strongly disagree", "Disagree", "Undecided", "Agree", "Strongly agree"))) %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "#FFDEDE") +
  facet_wrap(~measure) +
  theme_classic() +
  ylim(0, .7) +
  labs(y = NULL,
       x = NULL) +
    theme(legend.position = "none",
        text = element_text(),
        axis.text.y=element_blank(),
        axis.line.y = element_blank(),
        axis.ticks.y=element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  geom_vline(aes(xintercept = mean(as.numeric(value))), linetype = "solid", size = .4, color = "#787575") +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4)


p_phone <- wrap_plots(phone_int, phone_dis, phone_1yr) 
p_phone +
 plot_annotation(
  title = "Figure S3<br><br> Carrying Phone Acceptability",
  caption =  "<i>Note:</i> Sample size is 154. Solid line represents the mean and dashed line represents the neutral/ambivalent <br>score."
) &
  theme(plot.caption = element_markdown(hjust = 0, size = 10, lineheight = 1),
        text = element_text(),
        plot.title = element_markdown(size = 12),
        plot.subtitle = element_markdown(size = 12))
```


<br>


```{r}
burden_ema_1x <- burden %>% 
  select(subid, date, daily_survey_1_1year) %>% 
  group_by(subid) %>% 
  arrange(desc(date)) %>% 
  slice(1) %>% 
  ungroup()

plot_ema_1x <- burden_ema_1x %>% 
  rename(`Willingness to Continue for One Year` = daily_survey_1_1year) %>% 
  pivot_longer(`Willingness to Continue for One Year`, names_to = "measure") %>% 
  mutate(value = factor(value, levels = c(-2:2),
                        labels = c("Strongly disagree", "Disagree", "Undecided", "Agree", "Strongly agree"))) %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "#FFDEDE") +
  facet_wrap(~measure) +
  theme_classic() +
  ylim(0, .7) +
  labs(y = "Proportion",
       x = NULL) +
    theme(legend.position = "none",
        text = element_text(),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  geom_vline(aes(xintercept = mean(as.numeric(value))), linetype = "solid", size = .4, color = "#787575") +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4)

plot_ema_1x +
 plot_annotation(
  title = "Figure S4<br><br>Willingness to Complete a Once Daily Ecological Momentary Assessment for One Year",
  caption =  "<i>Note:</i> Sample size is 154. Solid line represents the mean and dashed line represents the neutral/ambivalent score."
) &
  theme(plot.caption = element_markdown(hjust = 0, size = 10, lineheight = 1),
        text = element_text(),
        plot.title = element_markdown(size = 12),
        plot.subtitle = element_markdown(size = 12))
```

<br>

**One sample t-test of willingness to use 1 x daily EMA for 1 year compared to a neutral/ambivalent score**   
*Acceptability ratings for a one time daily EMA were significantly higher than neutral, t(153) = 15.21, p < .001*   
```{r}
m_ema_1x <- lm(daily_survey_1_1year ~ 1, data = burden_ema_1x)
summary(m_ema_1x)
```


<br>


**Paired sample t-test of willingess to use 4 x daily EMA for 1 year compared to 1 x daily EMA**   
*Participants were significantly more likely to be willing to complete EMA's one time daily (M = 1.26, SD = 1.03) compared to four times daily (M = 0.64, SD = 1.22) for one year to help their recovery, t(153) = -8.32, p < .001*  
```{r}
# create long dataframe
burden_ema_1x_and_4x <- burden %>% 
  select(subid, date, `EMA 1x` = daily_survey_1_1year, `EMA 4x` = daily_survey_4_1year) %>% 
  group_by(subid) %>% 
  arrange(desc(date)) %>% 
  slice(1) %>% 
  ungroup() %>% 
  pivot_longer(`EMA 1x`:`EMA 4x`, names_to = "ema_frequency")

# t-test
m_ema_1x_and_4x <- lme4::lmer(value ~ ema_frequency + (1| subid), data = burden_ema_1x_and_4x)
summary(m_ema_1x_and_4x)
car::Anova(m_ema_1x_and_4x, type = 3, test = "F")
```

 



<br>

```{r}
screen <- read_csv(file.path(path_data, "screen.csv"), col_types = cols()) 
disposition <- read_csv(file.path(path_burden, "disposition.csv"), col_types = cols()) 

# remove ineligible participants
eligible_sample <- disposition %>%  
  filter(reason_no_intake != "ineligible" | is.na(reason_no_intake))
screen <- screen %>% 
  filter(subid %in% eligible_sample$subid)

# select demographic and AUD variables
screen <- screen %>% 
  select(subid, dem_1:dem_8, -dem_3_1, -dem_4_1, -dem_6_1, auh_1:auh_7, -auh_6_7_text, 
         starts_with("dsm5_"), assist_1_1:assist_1_8) 

# add grouping variable (completed 1st month vs discontinued)
sample_completed <- disposition %>% 
  filter(last_visit != "screen" & last_visit != "intake")
screen <- screen %>% 
  mutate(disposition = case_when(subid %in% sample_completed$subid ~ "continued",
                                 TRUE ~ "discontinued"))

# give descriptive names to variables and recode
screen <- screen %>% 
  # demographics
  rename(age = dem_1,
         sex = dem_2,
         race = dem_3,
         Hispanic = dem_4,
         education = dem_5,
         employment = dem_6,
         income = dem_7,
         marrital_status = dem_8) %>% 
  mutate(male = recode(sex, "Male" = 1, "Female" = 0),
         race = factor(race, levels = c("American Indian/Alaska Native", "Asian",
                                        "Black/African American", "Other/Multiracial",
                                        "White/Caucasian"), labels = c("American Indian or Alaska Native", "Asian",
                                        "Black/African American", "Multiracial or not listed above",
                                        "white")),
         Hispanic = case_when(Hispanic == "No, I am not of Hispanic, Latino, or Spanish origin" ~ 0,
                         TRUE ~ 1),
         education = factor(education, 
                         levels = c("Less than high school or GED degree", "High school or GED", 
                         "Some college", "2-Year degree", "College degree", "Advanced degree"),
                         ordered = TRUE),
         employment = factor(employment),
         marrital_status = factor(marrital_status)) %>% 
  # AUH 
  rename(age_first_drink = auh_1,
         age_reg_drink = auh_2,
         age_problem_drink = auh_3,
         age_first_quit = auh_4,
         num_quit_attempts = auh_5,
         lt_residential_tx = auh_6_1,
         st_residential_tx = auh_6_2,
         outpatient_tx = auh_6_3,
         individ_counseling = auh_6_4,
         group_counseling = auh_6_5,
         aa_or_na = auh_6_6,
         other_tx = auh_6_7,
         med_for_aud = auh_7) %>% 
  # recode tx vars as ordered no yes factors
  mutate(lt_residential_tx = case_when(lt_residential_tx == "Long-Term Residential Treatment (more than 6 months)" ~ 1,
                                       TRUE ~ 0),
         st_residential_tx = case_when(st_residential_tx == "Short-Term Residential Treatment (less than 6 months)" ~ 1,
                                       TRUE ~ 0),
         outpatient_tx = case_when(outpatient_tx == "Outpatient Treatment" ~ 1,
                                       TRUE ~ 0),
         individ_counseling = case_when(individ_counseling == "Individual Counseling" ~ 1,
                                       TRUE ~ 0),
         group_counseling = case_when(group_counseling == "Group Counseling" ~ 1,
                                       TRUE ~ 0),
         aa_or_na = case_when(aa_or_na == "Alcoholics Anonymous/Narcotics Anonymous" ~ 1,
                                       TRUE ~ 0),
         other_tx = case_when(other_tx == "Other" ~ 1,
                                       TRUE ~ 0),
         med_for_aud = recode(med_for_aud, "No" = 0, "Yes" = 1)) %>% 
  # Assist
  mutate(tobacco = recode(assist_1_1, "No" = 0, "Yes" = 1),
         cannabis = recode(assist_1_2, "No" = 0, "Yes" = 1),
         cocaine = recode(assist_1_3, "No" = 0, "Yes" = 1),
         amphetamine = recode(assist_1_4, "No" = 0, "Yes" = 1),
         inhalant = recode(assist_1_5, "No" = 0, "Yes" = 1),
         sedative = recode(assist_1_6, "No" = 0, "Yes" = 1),
         hallucinogen = recode(assist_1_7, "No" = 0, "Yes" = 1),
         opiate = recode(assist_1_8, "No" = 0, "Yes" = 1)) %>% 
  # dsm5
  mutate(across(dsm5_1:dsm5_11, ~ recode(., "No" = 0, "Yes" = 1))) %>% 
  # remove duplicate vars
  select(-c(assist_1_1:assist_1_8), -sex) %>% 
  select(subid, disposition, everything()) 

# combine variables
screen_combined <- screen %>% 
  # calculate total dsm5 score by adding up dsm5_1 through dsm5_11
  rowwise() %>% 
  mutate(dsm5_total = sum(dsm5_1, dsm5_2, dsm5_3, dsm5_4, dsm5_5, dsm5_6, dsm5_7, 
                            dsm5_8, dsm5_9, dsm5_10, dsm5_11),
         num_types_tx = sum(lt_residential_tx, st_residential_tx, outpatient_tx, 
                            individ_counseling, group_counseling, aa_or_na, other_tx, med_for_aud),
         num_other_drugs = sum(tobacco, cannabis, cocaine, amphetamine, inhalant,
                               sedative, hallucinogen, opiate),
         avg_age_aud_milestones = sum(age_first_drink, age_reg_drink, age_problem_drink,
                                       age_first_quit)/ 4,
         white = case_when(race == "white" ~ 1,
                          TRUE ~ 0),
         employed = case_when(employment == "Employed" ~ 1,
                          TRUE ~ 0),
         married = case_when(marrital_status == "Married" ~ 1,
                          TRUE ~ 0)) %>% 
  ungroup() %>% 
  select(-c(age_first_drink:age_first_quit, lt_residential_tx:dsm5_11, tobacco:opiate, race,
            employment, marrital_status)) 

# t-tests
screen_combined_long <- screen_combined %>%
  select(-subid) %>% 
  mutate(education = as.numeric(education)) %>% 
  pivot_longer(-disposition, names_to = "variables", values_to = "value")

screen_combined_long %>%
  group_by(variables) %>%
  t_test(value ~ disposition) %>%
  adjust_pvalue(method = "holm") %>%
  add_significance() %>% 
  select(` ` = variables,
         `Group 1` = group1,
         `Group 2` = group2,
         `N 1` = n1,
         `N 2` = n2,
         t = statistic,
         df,
         p,
         `p adj` = p.adj,
         `p adj sig` = p.adj.signif) %>% 
  kbl(digits = 2,
      align = c("l", "c", "c", "c", "c", "c", "c", "c", "c", "c"),
      caption = "<b>Table S1<br><br>T-Tests with Holm-Bonferroni Correction to Compare Group Differences between Continued and Discontinued Participants</b>") %>% 
  kable_classic(html_font = "Arial")
```



```{r}
# dataframe of last survey
# pull out last available sleep monitor data since this date will be earlier than last survey date for some
burden_sleep <- burden %>% 
  select(-contains("wristband")) %>% 
  filter(!is.na(sleep_interfere)) %>% 
  group_by(subid) %>% 
  arrange(desc(date)) %>% 
  slice(1) %>% 
  ungroup() %>% 
  select(c(subid, starts_with("sleep_")))
  
# pull out most recent survey for each subid
burden_last <- burden %>% 
  select(-c(starts_with("sleep_"), contains("wristband"))) %>% 
  group_by(subid) %>% 
  arrange(desc(date)) %>% 
  slice(1) %>% 
  ungroup() %>% 
  # join with sleep data
  full_join(burden_sleep, by = c("subid"))
```

```{r}
# run pairwise comparisons
int_pair <- burden_last %>% 
  select(`Daily Survey` = daily_survey_interfere,
         `Audio Check-in` = audio_checkin_interfere,
         `Sleep Monitor` = sleep_interfere) %>%
  pivot_longer(cols = everything(), names_to = "signal") %>% 
  mutate(signal = factor(signal)) 

# pairwise.t.test(int_pair$value, int_pair$signal, p.adj = "none") %>% 
#   broom::tidy() %>% 
#   rename(`Signal 1` = group1,
#          `Signal 2` = group2,
#          `$p$` = p.value) %>% 
#   kbl() %>% 
#   kable_classic(html_font = "Times new roman") 

dis_pair <- burden_last %>% 
  select(`Daily Survey` = daily_survey_dislike,
         `Audio Check-in` = audio_checkin_dislike,
         `Sleep Monitor` = sleep_dislike,
         `Location` = location_dislike,
         `Logs (SMS/call)` = all_logs_dislike,
         `SMS Content` = sms_content_dislike) %>%
  pivot_longer(cols = everything(), names_to = "signal") %>% 
  mutate(signal = factor(signal)) 

# pairwise.t.test(dis_pair$value, dis_pair$signal, p.adj = "none") 

will_pair <- burden_last %>% 
  select(`Daily Survey` = daily_survey_4_1year,
         `Audio Check-in` = audio_checkin_1year,
         `Sleep Monitor` = sleep_1year,
         `Location` = location_1year,
         `Logs (SMS/call)` = all_logs_1year,
         `SMS Content` = sms_content_1year) %>%
  pivot_longer(cols = everything(), names_to = "signal") %>% 
  mutate(signal = factor(signal)) 

# pairwise.t.test(will_pair$value, will_pair$signal, p.adj = "none") 
```


```{r}
# format table
tibble(
  Measure = c("Ecological Momentary Assessment", "Sleep Quality",
              "Ecological Momentary Assessment", "Sleep Quality", 
              "Moment-by-Moment Geolocation", "Cellular Communication Logs", "Text Message Content",
              "Ecological Momentary Assessment", "Sleep Quality",
              "Moment-by-Moment Geolocation", "Cellular Communication Logs", "Text Message Content"),
  "Audio Check-in" = c(
                       # interference
                       ".25", "< .001***", 
                       # dislike
                       "< .001***", "< .001***", "< .001***", ".001***", ".56", 
                       # willingness
                       ".47", ".46", ".14", ".42", ".96"), 
  "Ecological Momentary Assessment" = c(
                     # interference
                     NA, "< .001***", 
                     # Dislike
                     NA, ".30", ".56", ".63", ".002**",
                     # willingness
                     NA, ".18", ".03*", ".13", ".44"), 
  "Sleep Quality" = c(
                      # interference
                      NA, NA, 
                      # dislike
                      NA, NA, ".59", ".15", "< .001***", 
                      # willingness
                      NA, NA, ".60", ".97", ".49"), 
  "Moment-by-Moment Geolocation" = c(
                 # interference
                 NA, NA,  
                 # dislike 
                 NA, NA, NA, ".29", "< .001***", 
                 # willingness 
                 NA, NA, NA, ".50", ".15"), 
  "Cellular Communication Logs" = c(
                        # interference
                        NA, NA, 
                        # dislike
                        NA, NA, NA, NA, ".01**", 
                        # willingness
                        NA, NA, NA, NA, ".44")) %>% 
  kbl(align = c("l", "c", "c", "c", "c", "c"),
      caption = "<b>Table S2<br><br>Uncorrected Pairwise Comparison P Values for Pairs of Personal Sensing Methods across the Three Measures of Self Reported Acceptability</b>",
      escape = FALSE) %>% 
  kable_classic(html_font = "Arial") %>% 
  pack_rows("Interference", 1, 2, bold = FALSE) %>% 
  pack_rows("Dislike", 3, 7, bold = FALSE) %>% 
  pack_rows("Willingness to Continue", 8, 12, bold = FALSE) %>% 
  footnote("Sample size for all personal sensing measures is 154 except for the sleep monitoring which had a sample size of 87.<br>* <i>p</i> < .05, ** <i>p</i> < .01, *** <i>p</i> < .001", escape = FALSE)
```


<br>





```{r}
# read in excel phone tracking sheet
phones <- readxl::read_excel("P:/studydata/risk/administration/Participants/Technology Tracking/participant_phone_use_ALL.xlsx", range = "A1:F269") %>% 
  rename(subid = `Sub ID`) %>% 
  mutate(subid = as.numeric(subid)) %>% 
  clean_names() 

# glimpse(phones)

# filter down to burden sample (n = 154)
phones <- phones %>% 
  filter(subid %in% burden$subid)

# table
# phones %>% 
#   tabyl(phone_type)

phones <- phones %>% 
  mutate(phone = case_when(str_detect(phone_type, "Study") ~ "Study Phone",
                           TRUE ~ "Own Phone"))

phones %>% 
  tabyl(phone) %>% 
  kbl(caption = "<b>Table S3<br><br>Number and percentage of participants that use their own smartphone or study iphone</b>", digits = 2) %>% 
  kable_classic(html_font = "Arial") 
```




<br>

<br>


