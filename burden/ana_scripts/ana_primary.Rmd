---
title: "Primary Analyses"
author: "Kendra Wyant"
date: '`r format(Sys.time(), "%Y-%m-%d")`'
output: 
  html_document:
    toc: true 
    toc_depth: 4
---

Purpose: This file contains the following primary analyses along with supporting figures

* One-way ANOVA to assess effort on willingness to continue using signals
* Correlation matrix for each self-report measure with signal means and SDs
* ICC to assess consistency in ratings across signals for each self-report measure


### Setup
```{css, echo = FALSE}
pre, code {
  max-height: 500px;
  overflow-y: auto;
  white-space: pre !important; 
  overflow-x: auto
}
```

Paths 
```{r}
path_burden <- "/Volumes/private/studydata/risk/analysis/burden/data"
```

Packages and Source
```{r, message = FALSE, warning = FALSE}
library(tidyverse)
library(kableExtra)
library(lme4)
library(ggtext)
library(car)
library(corx)
library(patchwork)
library(psych)

options(knitr.kable.NA = '')
```

```{r echo = FALSE}
# function for adding Y label - code from Stack overflow
add_global_label <- function(pwobj, Xlab = NULL, Ylab = NULL, Xgap = 0.03, Ygap = 0.03, ...) {
  ylabgrob <- patchwork::plot_spacer()
  if (!is.null(Ylab)) {
    ylabgrob <- ggplot() +
      geom_text(aes(x = 1, y = 1), label = Ylab, angle = 90, family = "Times New Roman", size = 4.5) +
      theme_void() 
  }
  if (!is.null(Xlab)) {
    xlabgrob <- ggplot() +
      geom_text(aes(x = .5, y = .5), label = Xlab) +
      theme_void() 
  }
  if (!is.null(Ylab) & is.null(Xlab)) {
    return((ylabgrob + patchworkGrob(pwobj)) + 
             patchwork::plot_layout(widths = 100 * c(Ygap, 1 - Ygap)))
  }
  if (is.null(Ylab) & !is.null(Xlab)) {
    return((ylabgrob + pwobj) + 
             (xlabgrob) +
             patchwork::plot_layout(heights = 100 * c(1 - Xgap, Xgap),
                                    widths = c(0, 100),
                                    design = "
                                   AB
                                   CC
                                   "
             ))
  }
  if (!is.null(Ylab) & !is.null(Xlab)) {
    return((ylabgrob + pwobj) + 
             (xlabgrob) +
             patchwork::plot_layout(heights = 100 * c(1 - Xgap, Xgap),
                                    widths = 100 * c(Ygap, 1 - Ygap),
                                    design = "
                                   AB
                                   CC
                                   "
             ))
  }
  return(pwobj)
}
```

<br>


### Read in data
```{r}
burden <- read_csv(file.path(path_burden, "burden.csv"), col_types = cols()) %>% 
  # wristband will be analyzed in supplemental - not enough observations
  select(-contains("wristband"))
  # daily survey (x1) will only be included in supplemental also
```

Pull out last observation for each participant
```{r}
# pull out last available sleep monitor data since this date will be earlier than last survey date for some
burden_sleep <- burden %>% 
  filter(!is.na(sleep_interfere)) %>% 
  group_by(subid) %>% 
  arrange(desc(date)) %>% 
  slice(1) %>% 
  ungroup() %>% 
  select(c(subid, starts_with("sleep_")))
  
# pull out most recent survey for each subid
burden_last <- burden %>% 
  select(-c(starts_with("sleep_"))) %>% 
  group_by(subid) %>% 
  arrange(desc(date)) %>% 
  slice(1) %>% 
  ungroup() %>% 
  # join with sleep data
  full_join(burden_sleep, by = c("subid")) %>% 
  glimpse()
```


### Analysis of Effort on Willingness to Use and Dislike

#### Create dataframes   

* active = audio check in and daily survey
* passive = location, sms content, logs

NOTE: Sleep monitor is an active measure but due to sample size is not included in analyses. Carrying phone is not included as personal sensing signal. Daily survey (x 1) is hypothetical and only included in supplemental.  
Means and differences
```{r}
burden_dislike <- burden_last %>% 
  # get subject level means for active and passive measures
  group_by(subid) %>% 
  summarise(active = mean(c(daily_survey_dislike, audio_checkin_dislike), na.rm = TRUE),
            passive = mean(c(location_dislike, all_logs_dislike, sms_content_dislike), na.rm = TRUE),
            dislike_diff = passive - active) 
burden_dislike %>% 
  print(n = Inf)
```

```{r}
burden_willingness <- burden_last %>% 
  # get subject level means for active and passive measures
  group_by(subid) %>% 
  summarise(active = mean(c(daily_survey_4_1year, audio_checkin_1year), na.rm = TRUE),
            passive = mean(c(location_1year, all_logs_1year, sms_content_1year), na.rm = TRUE),
            willingness_diff = passive - active) 
burden_willingness %>% 
  print(n = Inf)
```


#### ANOVA
  
**Dislike**
```{r}
m_dislike <- lm(dislike_diff ~ 1, data = burden_dislike)
summary(m_dislike)
Anova(m_dislike, type = 3, test = "F")
```

**Willingness**
```{r}
m_willingness <- lm(willingness_diff ~ 1, data = burden_willingness)
summary(m_willingness)
Anova(m_willingness, type = 3, test = "F")
```


*Intercept = mean difference between active and passive group; test compares this to the mean.*    

<br>

Long format confirms exact same values    
Willingness
```{r}
burden_willingness_long <- burden_willingness %>% 
  pivot_longer(cols = c(active, passive), names_to = "effort", values_to = "willingness")

# don't need random effects for effort since only one observation per level
m_willingness_long <- lmer(willingness ~ effort + (1 | subid), data = burden_willingness_long)
summary(m_willingness_long)
Anova(m_willingness_long, type = 3, test = "F")
```

Dislike
```{r}
burden_dislike_long <- burden_dislike %>% 
  pivot_longer(cols = c(active, passive), names_to = "effort", values_to = "dislike")

m_dislike_long <- lmer(dislike ~ effort + (1 | subid), data = burden_dislike_long)
summary(m_dislike_long)
Anova(m_dislike_long, type = 3, test = "F")
```


<br>

#### Bar plots
Dislike
```{r}
m_graph <- lm(dislike ~ effort, data = burden_dislike_long)

d_graph <- expand.grid(effort = c("active", "passive"))
d_graph <- lmSupport::modelPredictions(m_graph, d_graph)

dislike_anova <- d_graph %>% 
  mutate(measure = "Dislike") %>% 
  mutate(effort = ifelse(effort == "active", "Active", "Passive")) %>% 
  ggplot(aes(x = effort, y = Predicted, fill = effort)) +
  geom_bar(stat = "identity", color = "black") +
  geom_errorbar(aes(ymax = CIHi, ymin = CILo), width = .25) +
  labs(x = NULL,
       y = NULL) +
  facet_wrap(~ measure) +
  theme_classic() +
  theme(text = element_text(family = "Times New Roman", size = 12),
        legend.position = "none", 
        legend.background = element_blank()) +
  scale_fill_manual(values = c("#FFDEDE", "#DBF8FF")) +
  scale_y_continuous(breaks = c(-2, -1, 0, 1, 2), labels = c("Strongly agree", "Agree", "Undecided", "Disagree", "Strongly disagree"), limits = c(-2, 2)) +
  geom_hline(yintercept = 0, linetype = "dashed", size = .4, color = "#444242")
```

Willingness
```{r}
m_graph_2 <- lm(willingness ~ effort, data = burden_willingness_long)

d_graph_2 <- expand.grid(effort = c("active", "passive"))
d_graph_2 <- lmSupport::modelPredictions(m_graph_2, d_graph_2)

willingness_anova <- d_graph_2 %>%
  mutate(measure = "Willingness to Continue") %>% 
  mutate(effort = ifelse(effort == "active", "Active", "Passive")) %>% 
  ggplot(aes(x = effort, y = Predicted, fill = effort)) +
  geom_bar(stat = "identity", color = "black") +
  geom_errorbar(aes(ymax = CIHi, ymin = CILo), width = .25) +
  labs(x = NULL,
       y = NULL) +
  facet_wrap(~ measure) +
  theme_classic() +
  theme(text = element_text(family = "Times New Roman", size = 12),
        legend.position = "none", 
        legend.background = element_blank()) +
  scale_fill_manual(values = c("#FFDEDE", "#DBF8FF")) +
  scale_y_continuous(breaks = c(-2, -1, 0, 1, 2), position = "right", labels = c("Strongly disagree", "Disagree", "Undecided", "Agree", "Strongly agree"), limits = c(-2, 2)) +
  geom_hline(yintercept = 0, linetype = "dashed", size = .4, color = "#444242") +
  ggsignif::geom_signif(comparisons = list(c("Active", "Passive")), 
              annotations = "*")
```

Save figures
```{r}

final_anova <- wrap_plots(dislike_anova, willingness_anova, ncol = 2)

# ggsave(plot = final_anova,  "~/Desktop/anova.png", width = 8.5, height = 4, units = "in", device = "png",  dpi = 500)

```


### Self Report Acceptability

```{r}
# run regressions (one sample t-tests) for each measure and item
int_sl <- broom::tidy(lm(sleep_interfere ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$sleep_interfere, na.rm = TRUE),
         d = mean(burden_last$sleep_interfere, na.rm = TRUE)/sd)
int_a <-  broom::tidy(lm(audio_checkin_interfere ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$audio_checkin_interfere, na.rm = TRUE),
         d = mean(burden_last$audio_checkin_interfere, na.rm = TRUE)/sd)
int_s4 <-  broom::tidy(lm(daily_survey_interfere ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$daily_survey_interfere, na.rm = TRUE),
         d = mean(burden_last$daily_survey_interfere, na.rm = TRUE)/sd)
dis_sl <-  broom::tidy(lm(sleep_dislike ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$sleep_dislike, na.rm = TRUE),
         d = mean(burden_last$sleep_dislike, na.rm = TRUE)/sd)
dis_a <-  broom::tidy(lm(audio_checkin_dislike ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$audio_checkin_dislike, na.rm = TRUE),
         d = mean(burden_last$audio_checkin_dislike, na.rm = TRUE)/sd)
dis_s4 <-  broom::tidy(lm(daily_survey_dislike ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$daily_survey_dislike, na.rm = TRUE),
         d = mean(burden_last$daily_survey_dislike, na.rm = TRUE)/sd)
dis_loc <-  broom::tidy(lm(location_dislike ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$location_dislike, na.rm = TRUE),
         d = mean(burden_last$location_dislike, na.rm = TRUE)/sd)
dis_log <-  broom::tidy(lm(all_logs_dislike ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$all_logs_dislike, na.rm = TRUE),
         d = mean(burden_last$all_logs_dislike, na.rm = TRUE)/sd)
dis_sms <-  broom::tidy(lm(sms_content_dislike ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$sms_content_dislike, na.rm = TRUE),
         d = mean(burden_last$sms_content_dislike, na.rm = TRUE)/sd)
use_a <-  broom::tidy(lm(audio_checkin_1year ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$audio_checkin_1year, na.rm = TRUE),
         d = mean(burden_last$audio_checkin_1year, na.rm = TRUE)/sd)
use_sl <-  broom::tidy(lm(sleep_1year ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$sleep_1year, na.rm = TRUE),
         d = mean(burden_last$sleep_1year, na.rm = TRUE)/sd)
use_s4 <-  broom::tidy(lm(daily_survey_4_1year ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$daily_survey_4_1year, na.rm = TRUE),
         d = mean(burden_last$daily_survey_4_1year, na.rm = TRUE)/sd)
use_s1 <-  broom::tidy(lm(daily_survey_1_1year ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$daily_survey_1_1year, na.rm = TRUE),
         d = mean(burden_last$daily_survey_1_1year, na.rm = TRUE)/sd)
use_loc <-  broom::tidy(lm(location_1year ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$location_1year, na.rm = TRUE),
         d = mean(burden_last$location_1year, na.rm = TRUE)/sd)
use_log <-  broom::tidy(lm(all_logs_1year ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$all_logs_1year, na.rm = TRUE),
         d = mean(burden_last$all_logs_1year, na.rm = TRUE)/sd)
use_sms <-  broom::tidy(lm(sms_content_1year ~ 1, data = burden_last)) %>% 
  mutate(sd = sd(burden_last$sms_content_1year, na.rm = TRUE),
         d = mean(burden_last$sms_content_1year, na.rm = TRUE)/sd)
```

#### Interference

*Going to remove stars and bold significant values in word version.*

```{r}
corrplot_int <- burden_last %>% 
  select(`Audio Check-in` = audio_checkin_interfere,
         `Daily Survey` = daily_survey_interfere,
         `Sleep Monitor` = sleep_interfere) %>%
  corx(triangle = "lower",
       stars = c(0.05),
       method = "pearson",
       describe = c(`$M$` = mean, `$SD$` = sd))

corrplot_int <- as_tibble(corrplot_int, rownames = " ")
corrplot_int[corrplot_int == " - " ] <- "--"

corrplot_int <- corrplot_int %>% 
  mutate(`$N$` = c(154, 154, 87)) %>% 
  mutate(`$t$` = c(str_c(round(int_a$statistic, 2), "*"), 
                   str_c(round(int_s4$statistic, 2), "*"), 
                   str_c(round(int_sl$statistic, 2), "*"))) %>% 
  mutate(`$d$` = (c(round(int_a$d, 2), round(int_s4$d, 2), round(int_sl$d, 2)))) %>% 
  select(` `, `1`, `2`, `$N$`, `$M$`, `$SD$`, everything())

corrplot_int %>% 
  kbl(align = c("l", "c", "c", "c", "c", "c", "c", "c")) %>% 
  kable_classic(html_font = "Times New Roman") %>% 
  row_spec(c(1:3), background = "#FFDEDE") %>% 
  pack_rows("Active", 1, 3, background = "#FFDEDE") %>% 
  footnote("* p < 0.05")
```

```{r warning = FALSE, fig.height = 3.5}
burden_plot_int <- burden_last %>% 
  select(contains("interfere")) %>%   
  pivot_longer(everything(), "measure", values_drop_na = TRUE) %>% 
  mutate(measure = factor(measure, 
                          levels = c("audio_checkin_interfere", "daily_survey_interfere", 
                                     "sleep_interfere", "carrying_phone_interfere"),
                          labels = c("Audio Check-in", "Daily Survey", "Sleep Monitor", "Carrying Phone"))) %>% 
  mutate(value = factor(value, levels = c(-2:2), labels = c("Strongly agree", "Agree", "Undecided", "Disagree", "Strongly disagree"))) %>% 
  mutate(active = case_when(measure == "Audio Check-in" ~ "Active",
                            measure == "Daily Survey" ~ "Active",
                            measure == "Sleep Monitor" ~ "Active")) 

active <- burden_plot_int %>% 
  filter(measure == "Audio Check-in" | measure == "Daily Survey" | measure == "Sleep Monitor") %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "#FFDEDE") +
  facet_grid(active ~ measure) +
  theme_classic() +
  labs(y = "Proportion",
       x = NULL) +
  theme(legend.position = "none",
        text = element_text(family = "Times New Roman", size = 12),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  ylim(0, .6) +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4, color = "#787575") +
  geom_vline(aes(xintercept = means), burden_plot_int %>% 
  filter(measure == "Audio Check-in" | measure == "Daily Survey" | measure == "Sleep Monitor") %>% 
  group_by(measure) %>% 
  summarise(means = mean(as.numeric(value), na.rm = TRUE)), size = .4) 


active
```

Save figure
```{r}
# ggsave(plot = active,  "~/Desktop/interference.png", width = 7.75, height = 3.5, units = "in", device = "png",  dpi = 1000)
```

#### Dislike

```{r}
corrplot_dis <- burden_last %>% 
  select(`Audio Check-in` = audio_checkin_dislike,
         `Daily Survey` = daily_survey_dislike,
         `Sleep Monitor` = sleep_dislike,
         `Location` = location_dislike,
         `Logs (SMS/voice)` = all_logs_dislike,
         `SMS Content` = sms_content_dislike) %>% 
  corx(triangle = "lower",
       stars = c(0.05),
       method = "pearson",
       describe = c(`$M$` = mean, `$SD$` = sd))

corrplot_dis <- as_tibble(corrplot_dis, rownames = " ")
corrplot_dis[corrplot_dis== " - " ] <- "--"

corrplot_dis <- corrplot_dis %>% 
  mutate(`$N$` = c(154, 154, 87, 154, 154, 154)) %>% 
  mutate(`$t$` = c(str_c(round(dis_a$statistic, 2), "*"), 
                   str_c(round(dis_s4$statistic, 2), "*"), 
                   str_c(round(dis_sl$statistic, 2), "*"),
                   str_c(round(dis_loc$statistic, 2), "*"), 
                   str_c(round(dis_log$statistic, 2), "*"), 
                   str_c(round(dis_sms$statistic, 2), "*"))) %>% 
  mutate(`$d$` = (c(round(dis_a$d, 2), round(dis_s4$d, 2), round(dis_sl$d, 2),
                    round(dis_loc$d, 2), round(dis_log$d, 2), round(dis_sms$d, 2)))) %>% 
  select(` `, `1`, `2`, `3`, `4`, `5`, `$N$`, `$M$`, `$SD$`, everything())

corrplot_dis %>% 
  kbl(align = c("l", "c", "c", "c", "c", "c", "c", "c", "c", "c", "c")) %>% 
  kable_classic(html_font = "Times New Roman") %>% 
  pack_rows("Active", 1, 3, background = "#FFDEDE") %>% 
  pack_rows("Passive", 4, 6, background = "#DBF8FF") %>% 
  row_spec(c(1:3), background = "#FFDEDE") %>% 
  row_spec(c(4:6), background = "#DBF8FF") %>% 
  footnote("* p < 0.05")
```

```{r message = FALSE, warning = FALSE, fig.height = 6}
burden_plot_dis <- burden_last %>% 
  select(contains("dislike")) %>%  
  pivot_longer(everything(), "measure", values_drop_na = TRUE) %>% 
   mutate(measure = factor(measure, 
                          levels = c("audio_checkin_dislike", "daily_survey_dislike", "sleep_dislike",
                                     "location_dislike", "all_logs_dislike", "sms_content_dislike"),
                          labels = c("Audio Check-in", "Daily Survey", "Sleep Monitor",
                                     "Location", "Logs (SMS/voice)", "SMS Content"))) %>% 
  mutate(value = factor(value, levels = c(-2:2), labels = c("Strongly agree", "Agree", "Undecided", "Disagree", "Strongly disagree"))) %>% 
  mutate(active = case_when(measure == "Audio Check-in" ~ "Active",
                            measure == "Daily Survey" ~ "Active",
                            measure == "Sleep Monitor" ~ "Active",
                            measure == "Location" ~ "Passive",
                            measure == "Logs (SMS/voice)" ~ "Passive",
                            measure == "SMS Content" ~ "Passive")) 

active_dis <- burden_plot_dis %>% 
  filter(measure == "Audio Check-in" | measure == "Daily Survey" | measure == "Sleep Monitor") %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "#FFDEDE") +
  facet_grid(active ~ measure) +
  theme_classic() +
  labs(y = NULL,
       x = NULL) +
  theme(legend.position = "none",
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        text = element_text(family = "Times New Roman")) +
  ylim(0, .65) +
  geom_vline(aes(xintercept = means), burden_plot_dis %>% 
  filter(measure == "Audio Check-in" | measure == "Daily Survey" | measure == "Sleep Monitor") %>% 
  group_by(measure) %>% 
  summarise(means = mean(as.numeric(value), na.rm = TRUE)), size = .4) +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4, color = "#787575") +
  theme(text = element_text(size = 12))


passive_dis <- burden_plot_dis %>% 
  filter(measure == "Location" | measure == "Logs (SMS/voice)" | measure == "SMS Content") %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "#DBF8FF") +
  facet_grid(active ~ measure) +
  theme_classic() +
  labs(y = NULL,
       x = NULL) +
    theme(legend.position = "none",
        text = element_text(family = "Times New Roman", size = 12),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  ylim(0, .6) +
  geom_vline(aes(xintercept = means), burden_plot_dis %>% 
  filter(measure == "Location" | measure == "Logs (SMS/voice)" | measure == "SMS Content") %>%  
  group_by(measure) %>% 
  summarise(means = mean(as.numeric(value), na.rm = TRUE)), size = .4) +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4, color = "#787575") 

dislike_final_plot <- wrap_plots(active_dis, passive_dis, ncol = 1)

dislike_final_plot <- dislike_final_plot  %>% 
  add_global_label(Ylab = "                   Proportion",
                   Ygap = .02
)

dislike_final_plot
```

Save Figure
```{r}
# ggsave(plot = dislike_final_plot,  "~/Desktop/dislike.png", width = 7.75, height = 6, units = "in", device = "png",  dpi = 1000)
```

#### Willingness to Continue

```{r}
corrplot_will <- burden_last %>% 
  select(`Audio Check-in` = audio_checkin_1year,
         `Daily Survey` = daily_survey_4_1year,
         `Sleep Monitor` = sleep_1year,
         `Location` = location_1year,
         `Logs (SMS/voice)` = all_logs_1year,
         `SMS Content` = sms_content_1year) %>% 
  corx(triangle = "lower",
       stars = c(0.05),
       method = "pearson",
       describe = c(`$M$` = mean, `$SD$` = sd))

corrplot_will <- as_tibble(corrplot_will, rownames = " ")
corrplot_will[corrplot_will== " - " ] <- "--"

corrplot_will <- corrplot_will %>% 
  mutate(`$N$` = c(154, 154, 87, 154, 154, 154)) %>% 
  mutate(`$t$` = c(str_c(round(use_a$statistic, 2), "*"),
                   str_c(round(use_s4$statistic, 2), "*"), 
                   str_c(round(use_sl$statistic, 2), "*"),
                   str_c(round(use_loc$statistic, 2), "*"), 
                   str_c(round(use_log$statistic, 2), "*"), 
                   str_c(round(use_sms$statistic, 2), "*"))) %>% 
  mutate(`$d$` = (c(round(use_a$d, 2), round(use_s4$d, 2), round(use_sl$d, 2),
                    round(use_loc$d, 2), round(use_log$d, 2), round(use_sms$d, 2)))) %>% 
  select(` `, `1`, `2`, `3`, `4`, `5`, `$N$`, `$M$`, `$SD$`, everything())

corrplot_will %>% 
  kbl(align = c("l", "c", "c", "c", "c", "c", "c", "c", "c", "c")) %>% 
  kable_classic(html_font = "Times New Roman") %>% 
  pack_rows("Active", 1, 3, background = "#FFDEDE") %>% 
  pack_rows("Passive", 4, 6, background = "#DBF8FF") %>% 
  row_spec(c(1:3), background = "#FFDEDE") %>% 
  row_spec(c(4:6), background = "#DBF8FF") %>% 
  footnote("* p < 0.05")
```


```{r message = FALSE, warning = FALSE, fig.height = 6}
burden_plot_1yr <- burden_last %>% 
  select(contains("1year")) %>%  
  pivot_longer(everything(), "measure", values_drop_na = TRUE) %>% 
  mutate(measure = factor(measure, 
                          levels = c("audio_checkin_1year", "daily_survey_4_1year", 
                                     "daily_survey_1_1year", "sleep_1year", "location_1year", 
                                     "all_logs_1year", "sms_content_1year"),
                          labels = c("Audio Check-in", "Daily Survey", "Daily Survey (x1)<i><sup>a</sup></i>",
                                     "Sleep Monitor", "Location", "Logs (SMS/voice)", "SMS Content"))) %>% 
  mutate(value = factor(value, levels = c(-2:2), labels = c("Strongly disagree", "Disagree", "Undecided", "Agree", "Strongly agree"))) %>% 
  mutate(active = case_when(measure == "Audio Check-in" ~ "Active",
                            measure == "Daily Survey" ~ "Active",
                            measure == "Sleep Monitor" ~ "Active",
                            measure == "Location" ~ "Passive",
                            measure == "Logs (SMS/voice)" ~ "Passive",
                            measure == "SMS Content" ~ "Passive")) 

willingness_active <- burden_plot_1yr %>% 
  filter(measure == "Audio Check-in" | measure == "Daily Survey" | measure == "Sleep Monitor") %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "#FFDEDE") +
  facet_grid(active ~ measure) +
  theme_classic() +
  labs(y = NULL,
       x = NULL) +
  theme(legend.position = "none",
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        text = element_text(family = "Times New Roman", size = 12),
        strip.text = element_markdown()) +
  ylim(0, .6) +
  geom_vline(aes(xintercept = means), burden_plot_1yr %>% 
  filter(measure == "Audio Check-in" | measure == "Daily Survey" | measure == "Sleep Monitor") %>% 
  group_by(measure) %>% 
  summarise(means = mean(as.numeric(value), na.rm = TRUE)), size = .4) +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4, color = "#787575")


willingness_passive <- burden_plot_1yr %>% 
  filter(measure == "Location" | measure == "Logs (SMS/voice)" | measure == "SMS Content") %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "#DBF8FF") +
  facet_grid(active ~ measure) +
  theme_classic() +
  labs(y = NULL,
       x = NULL) +
    theme(legend.position = "none",
        text = element_text(family = "Times New Roman", size = 12),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  ylim(0, .6) +
  geom_vline(aes(xintercept = means), burden_plot_1yr %>% 
  filter(measure == "Location" | measure == "Logs (SMS/voice)" | measure == "SMS Content") %>%  
  group_by(measure) %>% 
  summarise(means = mean(as.numeric(value), na.rm = TRUE)), size = .4) +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4, color = "#787575")

willingness_final_plot <- wrap_plots(willingness_active, willingness_passive, ncol = 1)

willingness_final_plot <- willingness_final_plot  %>% 
  add_global_label(Ylab = "                   Proportion",
                   Ygap = .02
)

willingness_final_plot
```

Save Figure
```{r}
# ggsave(plot = willingness_final_plot,  "~/Desktop/willingness.png", width = 7.75, height = 6, units = "in", device = "png",  dpi = 1000)
```

### ICC  

**Interested in type = ICC3**

#### Interference
```{r}
burden_last %>% 
  select(`Daily survey` = daily_survey_interfere,
         `Audio check-in` = audio_checkin_interfere) %>% 
  ICC()
```


#### Dislike
```{r}
burden_last %>% 
  select(`Daily survey` = daily_survey_dislike,
         `Audio check-in` = audio_checkin_dislike,
         `Location` = location_dislike,
         `Logs (SMS/voice)` = all_logs_dislike,
         `SMS content` = sms_content_dislike) %>%
  ICC()
```


#### Willingness
```{r}
burden_last %>% 
  select(`Daily survey` = daily_survey_4_1year,
         `Audio check-in` = audio_checkin_1year,
         `Location` = location_1year,
         `Logs (SMS/voice)` = all_logs_1year,
         `SMS content` = sms_content_1year) %>% 
  ICC()
```


<br>

<br>











