---
title: "Untitled"
format: pdf
csl: https://raw.githubusercontent.com/jjcurtin/lab_support/main/rmd_templates/csl/elsevier-vancouver.csl
geometry: margin=.5in
fontsize: 11pt
bibliography: paper_insight.bib
editor_options: 
  chunk_output_type: console
---



<!--General notes
Additional YAML formatting will need to be added once it's decided where this will be submitted. Tag Susan to handle that.

-->

```{r knitr_settings, include = FALSE}
# settings
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, cache = FALSE, 
                      message = FALSE)
options(knitr.kable.NA = '')
knitr::opts_chunk$set(fig.pos = "ht", out.extra = "")
```

```{r setup, include = FALSE}
library(knitr)
# library(yardstick) # for roc_curve
library(kableExtra)
library(janitor)
# library(corx)
library(patchwork)
library(ggtext)
library(consort)
library(tidyverse)
library(tidymodels)
library(tidyposterior)
library(cowplot)

theme_set(theme_classic()) 
```


```{r paths}
switch (Sys.info()[['sysname']],
        # PC paths
        Windows = {
          path_input <- "P:/studydata/risk/chtc/insight"
          path_processed <- "P:/studydata/risk/data_processed/insight"
          path_models <- "P:/studydata/risk/models/insight"
          path_shared <- "P:/studydata/risk/data_processed/shared"},

        # IOS paths
        Darwin = {
          path_input <- "/Volumes/private/studydata/risk/chtc/insight"
          path_processed <- "/Volumes/private/studydata/risk/data_processed/insight"
          path_models <- "/Volumes/private/studydata/risk/models/insight"
          path_shared <- "/Volumes/private/studydata/risk/data_processed/shared"},
        
        # Linux paths
        Linux = {
          path_input <- "~/mnt/private/studydata/risk/chtc/insight"
          path_processed <- "~/mnt/private/studydata/risk/data_processed/insight"
          path_models <- "~/mnt/private/studydata/risk/models/insight"
          path_shared <- "~/mnt/private/studydata/risk/data_processed/shared"}
        )
```

```{r load_data}
```

# Introduction

## Background

AUD/SUDs are problematic and prevalent and require lifelong care/monitoring.

Self-monitoring is thought to be a valuable and necessary tool during recovery from AUD and other SUDs.
-   Anecdotally - encouraged by clinicians, prompted by many self-help tools/apps, etc.
-   Empirically? Might be some evidence (Ariela's review & continued lit review)
-   Consider ARCP framing - there is a strongly held belief about monitoring perhaps without **sufficient evidence** and/or without **sufficient nuance** to how monitoring should be implemented

Self-monitoring, insight, and/or confidence in remaining abstinent/pursuing treatment goals has traditionally been measured statically.
-   Measures like the AASE are often used to assess an individual's "long-term" likelihood of remaining abstinent (Ariela's information about AASE as the most common measure and/or idea that most studies are just making up their own measures so there is little consistency or validation)
-   Scores from measures like the AASe may be used at the end of treatment/end of study/etc. to estimate an individual's future likelihood of staying abstinent
-   It is **unclear if or how clinicians use or might use static measures like the AASE** (e.g., in determining treatment conclusion or retention, in determining level of care, etc.)

It is **unclear how well static measures like the AASE predict future lapse/relapse outcomes**.

Risk of lapse/relapse is best understood **dynamically**.
-   Relapse prevention model
-   Fluctuating risk over time due to fluctuating proximal and distal risk factors that interact fluidly with one another
-   Thus, **monitoring dynamic risk of lapse likely requires dense, dynamic monitoring to be effective**.

**EMA** offers a method to assess individuals' insight into risk of lapse densely and longitudinally.
-   This has/has not? (look at review) been done before (check Y/N, duration of monitoring, question being asked, etc. - Ariela to add from review)
-   When done, it has/has not? (look at review - Ariela to add from review) been done with **true prediction**.

Continuous monitoring with EMA can be embedded within a digital therapeutic context that can allow for monitoring of other risk factors and offer access to supports and tools to be used throughout recovery.

## Current study

We measured individuals' insight into their own lapse risk via daily EMA surveys situated within a digital therapeutic.
-   Thus, insight was assessed in a way that was: **cued** (i.e., prompted to reflect), **contextualized** (i.e., asked at the end of the survey assessing 9 other relevant risk factors, with three additional daily surveys asking similar question - a LOT of reflection!), and **continuous** (i.e., daily assessments).
-   Question was asked about individuals' risk of lapsing in the next week, so we used corresponding 1-week outcome windows that began at the time of the daily survey completion.

The purpose of this project is to determine:

1. The accuracy of individuals' insight into their lapse risk (in the next week)

*Relevant model configurations*
1 week windows ~ insight only (raw)

2. Whether dynamic assessment of insight and lapse risk has more predictive value than static assessment of insight and/or lapse risk

*Relevant model configurations*
1 week windows ~ insight only (raw)
1 week windows ~ AASE total score only --> comparable to how an individual might currently use their own post-treatment insight to assess ongoing lapse risk
Dichotomous lapse (whether an individual lapsed or not during study period) ~ AASE total score only --> comparable to how a clinician might use post-treatment insight to determine whether an individual should leave or continue treatment

3. Whether models that take advantage of full EMA data & feature engineering can predict lapse risk more accurately than insight alone

*Relevant model configurations*
1 week windows ~ insight only (raw)
1 week windows ~ all EMA items (4x daily surveys, engineered features)

# Method
<!-- copy HEAVILY from EMA paper -->

## Research Transparency
<!-- 
make sure 21-word solution is accurate
make sure to update OSF links
-->

## Participants
<!-- identify if any participants excluded because of data exclusions (though maybe not here, still report on 151 sample?) -->

## Procedure

## Measures

### EMA

### AASE

### Individual Differences
<!-- just to characterize data, not included in analyses -->

## Data Analytic Strategy

### Lapse Labels

### Feature Engineering

### Model Training and Evaluation

# Results

## Demographic and Clinical Characteristics

<!-- Demographics table-->

## Model Performance

### auROC

### Model Comparisons

### Feature Importance

# Discussion

<!-- all just notes -->

Cued, contextualized, continuous insight can accurately predict dynamic risk of alcohol lapse.

Why is this good?

-   Shows the value of insight/self-monitoring that we have long suspected/believed, now with empirical evidence and with theoretical nuance regarding the need for dynamic assessment of predictor and outcome

-   Within a dtx environment, accurate insight may lead to increased: trust in the algorithm (risk feedback aligns with insight), engagement with the app (d/t trust, but also perhaps reengagement following a period of lower use), self-efficacy, etc.

-   There may be opportunities for decreased burden (following additional research) if insight can be used in place of a full survey (still with cued daily assessment & ask to reflect on contextual factors), but we don't know how that will do on its own

AASE has some predictive value for dichotomous (and even rolling week window) outcomes (supports value of self-monitoring) but is insufficient for prediction and clinical utility.

Dynamic insight measurement can predict better than static AASE measurement.

Prediction algorithms grow more accurate when we add in other EMA features from 4X daily surveys - we can do our best prediction when we use more information. 

Cued insight only permits an individual to know:
* with relatively high accuracy if they are going to lapse
Full ema context permits an individual to know:
* with even higher accuracy if they are going to lapse
* whether that lapse risk represents a change from previous risk levels
* whether their self-efficacy/insight is changing from previous levels
* the key contributing factors that are driving that changing risk
* the key factors that may be targeted to most effectively reduce high and/or increasing lapse risk

\clearpage

# References