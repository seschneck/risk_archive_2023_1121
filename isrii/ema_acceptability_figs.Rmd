---
title: "ISRII Acceptability Figures for EMA"
author: "Kendra Wyant"
date: '`r format(Sys.time(), "%Y-%m-%d")`'
output: 
  html_document:
    toc: true 
    toc_depth: 4
knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_dir = dplyr::if_else(Sys.info()[["sysname"]] == "Windows",
      "P:/studydata/risk/knits/ema", 
      "/Volumes/private/studydata/risk/knits/ema")
    )
  })
---

Packages and Paths
```{r, message = FALSE, warning = FALSE}
library(tidyverse)

path_data <- "P:/studydata/risk/data_processed/burden"
```


### Read in data
```{r}
data <- read_csv(file.path(path_data, "acceptability.csv"), col_types = cols()) %>% 
  select(subid, date, contains("daily_survey")) %>% 
  glimpse()
```


Pull out last observation for each participant
```{r}
# pull out most recent survey for each subid
data_last <- data %>% 
  group_by(subid) %>% 
  arrange(desc(date)) %>% 
  slice(1) %>% 
  ungroup() %>% 
  glimpse()
```

Remove subids with EMA reporting issues (see conclusions in mak_study_dates for exclusion reasons)
```{r}
data_last <- data_last %>% 
  filter(!subid %in% c(104, 269, 204)) %>% 
  glimpse()
```



### Interference Figure

```{r fig.height = 6}
plot_ema_interfere <- data_last %>% 
  select(subid, daily_survey_interfere) %>% 
  rename(Interference = daily_survey_interfere) %>% 
  pivot_longer(Interference, names_to = "measure") %>% 
  mutate(value = factor(value, levels = c(-2:2),
                        labels = c("Strongly agree", "Agree", "Undecided", "Disagree", "Strongly disagree"))) %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "light grey") +
  facet_wrap(~measure) +
  theme_classic() +
  ylim(0, .7) +
  labs(y = "Proportion",
       x = NULL) +
    theme(legend.position = "none",
        text = element_text(size = 14),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  geom_vline(aes(xintercept = mean(as.numeric(value))), linetype = "solid", size = .705, color = "#b44343") +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4, color = "#787575")

plot_ema_interfere
```


Uncomment to save figure  
*Note: Replace PATH with location to save plot.*
```{r}
# ggsave(plot = plot_ema_interfere, "PATH/acceptability_ema_interfere.png", width = 7.5, height = 6, units = "in", device = "png",  dpi = 500)
```



### Dislike Figure


```{r fig.height = 6}
plot_ema_dislike <- data_last %>% 
  select(subid, daily_survey_dislike) %>% 
  rename(Dislike = daily_survey_dislike) %>% 
  pivot_longer(Dislike, names_to = "measure") %>% 
  mutate(value = factor(value, levels = c(-2:2),
                        labels = c("Strongly agree", "Agree", "Undecided", "Disagree", "Strongly disagree"))) %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "light grey") +
  facet_wrap(~measure) +
  theme_classic() +
  ylim(0, .7) +
  labs(y = "Proportion",
       x = NULL) +
    theme(legend.position = "none",
        text = element_text(size = 14),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  geom_vline(aes(xintercept = mean(as.numeric(value))), linetype = "solid", size = .705, color = "#b44343") +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4, color = "#787575")

plot_ema_dislike
```


Uncomment to save figure  
*Note: Replace PATH with location to save plot.*
```{r}
# ggsave(plot = plot_ema_dislike, "PATH/acceptability_ema_dislike.png", width = 7.5, height = 6, units = "in", device = "png",  dpi = 500)
```


### Willingness to Continue for 1 Year Figures

#### 1X Daily

```{r fig.height = 6}
plot_ema_1x <- data_last %>% 
  select(subid, daily_survey_1_1year) %>% 
  rename(`Willingness to Continue for 1 Year (1X EMA)` = daily_survey_1_1year) %>% 
  pivot_longer(`Willingness to Continue for 1 Year (1X EMA)`, names_to = "measure") %>% 
  mutate(value = factor(value, levels = c(-2:2),
                        labels = c("Strongly disagree", "Disagree", "Undecided", "Agree", "Strongly agree"))) %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "light grey") +
  facet_wrap(~measure) +
  theme_classic() +
  ylim(0, .7) +
  labs(y = "Proportion",
       x = NULL) +
    theme(legend.position = "none",
        text = element_text(size = 14),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  geom_vline(aes(xintercept = mean(as.numeric(value))), linetype = "solid", size = .705, color = "#b44343") +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4, color = "#787575")

plot_ema_1x
```


Uncomment to save figure  
*Note: Replace PATH with location to save plot.*
```{r}
# ggsave(plot = plot_ema_1x, "PATH/acceptability_ema_1x.png", width = 7.5, height = 6, units = "in", device = "png",  dpi = 500)
```


#### 4X Daily

```{r fig.height = 6}
plot_ema_4x <- data_last %>% 
  select(subid, daily_survey_4_1year) %>% 
  rename(`Willingness to Continue for 1 Year (4X EMA)` = daily_survey_4_1year) %>% 
  pivot_longer(`Willingness to Continue for 1 Year (4X EMA)`, names_to = "measure") %>% 
  mutate(value = factor(value, levels = c(-2:2),
                        labels = c("Strongly disagree", "Disagree", "Undecided", "Agree", "Strongly agree"))) %>% 
  ggplot(aes(x = value, y = ..prop.., group = measure)) +
  geom_bar(color = "black", fill = "light grey") +
  facet_wrap(~measure) +
  theme_classic() +
  ylim(0, .7) +
  labs(y = "Proportion",
       x = NULL) +
    theme(legend.position = "none",
        text = element_text(size = 14),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  geom_vline(aes(xintercept = mean(as.numeric(value))), linetype = "solid", size = .705, color = "#b44343") +
  geom_vline(aes(xintercept = "Undecided"), linetype = "dashed", size = .4, color = "#787575")

plot_ema_4x
```


Uncomment to save figure  
*Note: Replace PATH with location to save plot.*
```{r}
# ggsave(plot = plot_ema_4x, "PATH/acceptability_ema_4x.png", width = 7.5, height = 6, units = "in", device = "png",  dpi = 500)
```