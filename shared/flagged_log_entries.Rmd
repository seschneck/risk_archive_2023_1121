---
title: "Flagged entries"
author: "Kendra Wyant"
date: "`r lubridate::today()`"
output: 
  html_document:
    toc: true 
    toc_depth: 4
    code_folding: show
editor_options: 
  chunk_output_type: console
knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_dir = dplyr::if_else(Sys.info()[["sysname"]] == "Windows",
      "P:/studydata/risk/knits/shared", 
      "/Volumes/private/studydata/risk/knits/shared")
    )
  })
---

### Set up Environment

Chunk Defaults
```{r defaults, include=FALSE}
knitr::opts_chunk$set(attr.output='style="max-height: 500px;"')

options(tibble.print_max = Inf)
options(tibble.width = Inf)
```

Absolute paths
```{r, paths}
switch (Sys.info()[['sysname']],
        # PC paths
        Windows = {
          path_raw <- "P:/studydata/risk/data_raw"
          path_shared <- "P:/studydata/risk/data_processed/shared"},

        # IOS paths
        Darwin = {
          path_raw <- "/Volumes/private/studydata/risk/data_raw"
          path_shared <- "/Volumes/private/studydata/risk/data_processed/shared"}
        )
```

Relative paths
```{r}
path_log <- "shared/notes"
```

Packages for lab workflow 
```{r, packages_workflow, message=FALSE, warning=FALSE}
library(conflicted) # detect and warn about function conflicts
 conflict_prefer("filter", "dplyr")
 conflict_prefer("select", "dplyr")

library(here)  # establish project directory consistently as working directory
```

Packages for script
```{r, packages_script, message=FALSE, warning=FALSE}
# for data wrangling
library(tidyverse)  # always need this
library(janitor) # cleaning and EDA
library(lubridate)

# for plots and tables
library(ggplot2)
theme_set(theme_bw()) # or theme_set(theme_classic())
library(kableExtra)
```


### Read in raw EMA
```{r}
ema_morning <- vroom::vroom(here(path_raw, 'qualtrics/ema_morning.csv'), col_types = vroom::cols()) %>% 
  rename(subid = SubID) %>% 
  rename(response_id = ResponseID) %>% 
  # put start and end date in central time
  mutate(StartDate = with_tz(StartDate, tzone = "America/Chicago"),
         EndDate = with_tz(EndDate, tzone = "America/Chicago"))

ema_later <- vroom::vroom(here(path_raw, 'qualtrics/ema_later.csv'), col_types = vroom::cols()) %>% 
  rename(subid = SubID) %>% 
  rename(response_id = ResponseID) %>% 
  # put start and end date in central time
  mutate(StartDate = with_tz(StartDate, tzone = "America/Chicago"),
         EndDate = with_tz(EndDate, tzone = "America/Chicago"))
```


### Read in Logs  

```{r}
log_morning <- vroom::vroom(here(path_log, "log_ema_morning.csv"), col_types = vroom::cols())
log_later <- vroom::vroom(here(path_log, "log_ema_later.csv"), col_types = vroom::cols()) 
```

Join
```{r}
log_all <- log_morning %>% 
  bind_rows(log_later)
```


### Read in Notes
```{r}
notes <- vroom::vroom(here(path_log, "raw_notes.csv"), col_types = vroom::cols())
```



### Flagged log entries

#### remove entries

**There are two surveys we currently remove via log that we may want to change to a note instead of a remove entry. These entries are not necessarily errors only incomplete information. Even if too incomplete for lapses they may be able to be used to determine validity of surrounding lapse/non-lapses.**         

**#1**     

Log entry says to remove the following response id due to no lapse dates or other variables.    
```{r}
log_all %>% 
  filter(response_id == "R_2aFWx2Wb8v0v8ZF") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```


Below is the raw EMA survey data for the associated response_id    
```{r}
ema_later %>% 
  filter(response_id == "R_2aFWx2Wb8v0v8ZF")
```

The UTC however matches a different incomplete survey by the same subid
```{r}
ema_morning %>% 
  filter(UTC == "1560435616")
```

*John - I think we should keep these incomplete surveys not remove them.*     


**#2**     

The survey being removed is incomplete except for Yes for EMAL_1 - the note in the log does not provide definitive support that this is made in error.        
*John - Do you agree we should not remove this entry since we are not doing this for other surveys with missing values surrounding the lapse?*
```{r}
log_all %>% 
  filter(response_id == "R_3kb0X4WnkKRBREK") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

Raw EMA survey   
Also noted that EMAM_1.1 is blank not 2 as the note suggests (these data have not been cleaned).
```{r}
ema_later %>% 
  filter(response_id == "R_3kb0X4WnkKRBREK")
```



#### recode_one lapse entries (Dates and times)


**#1**      
Change made to lapse date    

This entire survey is blank except for EMAM_1 has Yes as response. i think we should leave as is and change this to note entry. It doesn't seem we can impute a reliable date of the lapse based on this data log entry.    
```{r}
log_all %>% 
  filter(response_id == "R_cXU4FDBV12lZZPH") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

Raw survey
```{r}
ema_morning %>%
  filter(response_id == "R_cXU4FDBV12lZZPH")
```

Checked notes and data log but could find no additional information on how this date was chosen.   

*John - do you agree to change this to note instead of recode_one entry for lapse start and end date?*     



**#2**  
Change made to date/time of lapse   

Original lapse is a negative value 4/28/18 Midnight to 4/28/18 11 PM
```{r}
ema_morning %>% 
  filter(response_id == "R_UMzNw3jmwMIQOLn")
```

Log suggests correct time shoulf be 4/27/18 11:00 Pm - 4/28/18 midnight which would mean they not only got one of the dates wrong but they also switched the start and end times.   


*John - should we mark as NA or correct with current log entries (below)?*   

```{r}
log_all %>% 
  filter(response_id == "R_UMzNw3jmwMIQOLn") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```



**#3**    
Change made to lapse date    

Log changes start date from future date (9/22/18) to survey date (9/16/18). Since end time is 1 AM, it is more likely the start date was the day before (9/15/18). However, it is also possible they switched the times and they drank from 1 AM - 10 AM instead of 10 AM - 1 AM. OR they may have meant 10 PM - 1 AM.    

raw EMA
```{r}
ema_morning %>% 
  filter(response_id == "R_6MbQoC7cs9Nf8s1")
```

log entry
```{r}
log_all %>% 
  filter(response_id == "R_6MbQoC7cs9Nf8s1") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

*John - How to handle this lapse in log? Leave as is (recode date which still makes an invalid lapse), change date and/or time to NA, or make no changes and turn log entry into note?*    


**#4**   
Change made to lapse date   

I agree with Sarah that 3/22 is probably a typo for 2/22 (see log entry below). For this reason I think the time 4 PM is indicative of when they started drinking on 2/22 and cannot be used reliably as a start time for most recent lapse during vacation period.    

*John - I think this should be a note entry describing that 2/22 - 3/2/19 was a period of frequent lapses and should not be sampled from for non-lapses. What do you think?*    

```{r}
log_all %>% 
  filter(response_id == "R_RCtJwUMRAB68OQ1") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

raw EMA
```{r}
ema_morning %>% 
  filter(response_id == "R_RCtJwUMRAB68OQ1")
```


**#5**   
Change to lapse time    

raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_tSUEclMc9TqDttv")
```

We currently change both start time to 9 PM (instead of 9 AM) and end date due to confusion surrounding midnight being next day
```{r}
log_all %>% 
  filter(response_id == "R_tSUEclMc9TqDttv") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

*John - I think these changes make sense but wanted to get your thoughts since they are not definitive errors*    


**#6**  

At 12:58 PM on 9/22 the participant reports a lapse that starts at noon on 9/22 - they type none12PM in for end day we correct this to 9/22, but it may be that they are still drinking and they mean None for no end date.     

*John - We can probably leave log entry as is, but I wanted to flag this as a possibly unreliable end time which could impact non-lapse labels surrounding this lapse. What do you think?*     

raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_AbWYKI5zm1dTNUl")
```

No other lapses reported that day
```{r}
ema_later %>% 
  mutate(day = date(StartDate)) %>% 
  filter(subid == "118" & day == "2018-09-22")
```

```{r}
log_all %>% 
  filter(response_id == "R_AbWYKI5zm1dTNUl") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

 
**#7**    

*John - possible discrepancy with start time*    

It looks like they may have meant the start time to be 4 PM and the end time to be 5 PM. We currently change 0400 to start day (4/7/19) but leave start time as 5 PM.      

raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_12rPph45U4SL5ZP")
```

```{r}
log_all %>% 
  filter(response_id == "R_12rPph45U4SL5ZP") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```




**#8**   

*John - This lapse end time is in the future from time EMA was taken. I think its more likely that the end date was supposed to be 3-15-19 instead of the start date 3-16-19. Also the notes don't really explain why the time is changed also.*      

raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_UG5g0ac6eP3ad8Z")
```

Data log note = "Lapse on 3/15 – 3/16 from *3pm to 2pm* should be 3/16 – 3/16 from 2pm to 3pm", but the lapse time is actually 3/15 - 3/16 from *2 PM - 3 PM*.      

```{r}
log_all %>% 
  filter(response_id == "R_UG5g0ac6eP3ad8Z") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```




**#9**   

I am not sure these dates are correct. Makes more sense that it would be 11/16 8 PM - 11/17 5 AM instead of 11/17 8 PM - 11/18 5 AM since the survey was completed on 11/17.     

Although it was completed at 8:30 PM so maybe they were guessing the time they would be done drinking. Additionally see additional surveys below show they did not report any lapses earlier that day.      

*John - We currently change lapse to 11/17 8 PM - 11/18 time NA - should we leave as is?*    

raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_5jqOApLu6KgskSd")
```

```{r}
log_all %>% 
  filter(response_id == "R_5jqOApLu6KgskSd") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```


No other lapses reported that day or the next day
```{r}
ema_morning %>%  
  rename_with(~ str_replace(.x, "EMAM_", "EMA_")) %>% 
  mutate(day = date(StartDate)) %>% 
  filter(subid == "026" & day == "2017-11-17") %>% 
  bind_rows(ema_later %>% 
              rename_with(~ str_replace(.x, "EMAL_", "EMA_")) %>% 
              mutate(day = date(StartDate)) %>% 
              filter((subid == "026" & day == "2017-11-17") | (subid == "026" & day == "2017-11-18"))) %>% 
  filter(response_id != "R_5jqOApLu6KgskSd") 
```


**#10**   

*John - It looks like they meant to put start time as 2 PM and end time as 4 PM but they put 2 where the date goes. We correct 2 to the current date but leave 4 PM in the start time box. I think this should be 2 PM especially since the survey was completed at 3 PM so that would mean they hadn't started drinking yet.*       

raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_2OGOtpd9uxRssdQ")
```


```{r}
log_all %>% 
  filter(response_id == "R_2OGOtpd9uxRssdQ") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```




**#11**   

Flagging invalid lapse time (11pm - 7 pm)    

*John - Should we change times to NA? to 11 AM? Lapse currently set as 11 PM - 7PM on 3/22*      

```{r}
log_all %>% 
  filter(response_id == "R_D8ol8i40GxoCnKN") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_D8ol8i40GxoCnKN")
```


**#12**  

*John - not suggesting we do anything but wanted to flag this as a duplicate lapse with likely unreliable EMA Likert values.*       


Shortly before midnight a participant reports a lapse with start and end time at midnight - we change this to be 11 pm - midnight and change date to reflect midnight as next day  

Raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_3LcKMdZCiI2jUqj")
```

```{r}
log_all %>% 
  filter(response_id == "R_3LcKMdZCiI2jUqj") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```


However one minute earlier they reported a lapse as being from 9 pm - midnight and they have completely different values for the other EMA variables.    
```{r}
ema_later %>% 
  mutate(day = date(StartDate)) %>% 
  filter(subid == "048" & day == "2018-06-22")
```


The second lapse (midnight to midnight) doesn't seem to run over into lapses reported on surveys the next day (after midnight).   

```{r}
ema_morning %>%  
  rename_with(~ str_replace(.x, "EMAM_", "EMA_")) %>% 
  mutate(day = date(StartDate)) %>% 
  filter(subid == "048" & day == "2018-06-23") %>% 
  bind_rows(ema_later %>% 
              rename_with(~ str_replace(.x, "EMAL_", "EMA_")) %>% 
              mutate(day = date(StartDate)) %>% 
              filter(subid == "048" & day == "2018-06-23"))
```


**#13**   

Lapse reported on 4/3 at 9:17 to be from 4/4 8 PM - 4/3 11 PM    

Raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_SVH1i7a01JpgCgV")
```

We change start date to 4/3 to make lapse valid. However survey was taken at 9:17 PM on 4/3 so end time is in future.   

*John - I think we should leave as future end time for now but wanted to flag this. Thoughts?*

```{r}
log_all %>% 
  filter(response_id == "R_SVH1i7a01JpgCgV") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```



**#14**   

Lapse reported on 11/24 at 4:30 PM to be from 3 PM 11/17 - 4 AM 11/24    
Log entry changes this lapse to be on 11/24 from 3 PM - 4 PM   

*John - this seems reasonable but wanted to flag it since we are changing both start date and end time (AM to PM)*         

Raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_12R70VBT8K503Bs")
```


```{r}
log_all %>% 
  filter(response_id == "R_12R70VBT8K503Bs") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```


In general subid 128 has extremely frequent lapses and several log entry notes (see below)     

Subid 128's log entries
```{r}
log_all %>% 
  filter(subid == "128") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%", height = "500px")
```


**#15**  

Lapse time may not be accurate.     

Survey taken at 7:30 PM on 3-3-19 where they report a lapse from 3-3-19 4 PM to 3-5-19 Noon. We recode end date to 3-3-19 but don't change the end time.       

*John - Do you think we should set end time to NA? or keep as is (noon)?*    


Raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_3NDSbW7B3oXuLT8")
```

```{r}
log_all %>% 
  filter(response_id == "R_3NDSbW7B3oXuLT8") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```




**#16**   

Survey taken at 6 pm on 4/26 so not sure this log correction makes sense.   

Raw data lapse - 4/26 8 PM - 4/27 5 PM      
Data log correction - 4/26 5 PM - 4/26 8 PM (future lapse)    

Seems like the end time should be 4/26 5 PM since it is around the time of the survey. No way to know for sure and individual data logs have not always been reliable. This would also make the start time invalid (8 PM - 2 hours in future from survey start time).    

*John - how to handle?*   

Raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_3HhjMZZ3vfiflUd")
```

```{r}
log_all %>% 
  filter(response_id == "R_3HhjMZZ3vfiflUd") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

**#17**   
When inspecting duplicate lapse reports I found some info that may help correct a lapse that is as of right now over 24 hours 
2 surveys have same start date and time.   

The first time they report it they set the end time as 10 PM. This is 1.5 hours in future from when they took EMA which is why they must have re-reported the lapse once they knew the actual end time (11 PM). Except for end date they put 5/30 instead of 5/29. They reported this at 4 AM on the 30th so I am pretty sure the end date is supposed to be 11 PM on 5/29.     

*John - do you think this is a reasonable fix where I will change end time to 11 PM and change second lapse report to No for EMA_1 and NA for date and times?*

```{r}
ema_later %>% 
  filter(response_id == "R_32INTVsht297f4y")

ema_later %>% 
  filter(response_id == "R_A6Unu7gLOWGREcx")
```



**#18**   

This participant has a lapse from 4 PM - 4 PM on 5/26. They took the survey a few minutes before 4 PM so they must have rounded up.    

In the log we change this lapse from 3 PM - 4 PM to capture the lapse prior to the survey start and end time.    

*John - Do we want to do this at this point? It seems more like a study level preprocessing decision that needs to be done systematically.*   

```{r}
log_all %>% 
  filter(response_id == "R_22sEXLelx0MXfVQ") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

Raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_22sEXLelx0MXfVQ")
```


**#19**     

*John - Same rounding situation as above*   

```{r}
log_all %>% 
  filter(response_id == "R_1ILBYEfGH6Lspdk") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

Raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_1ILBYEfGH6Lspdk")
```

**#20**   

*Same rounding situation as above*  

```{r}
log_all %>% 
  filter(response_id == "R_3LcKMdZCiI2jUqj") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

Raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_3LcKMdZCiI2jUqj")
```

**#21**    

*Same rounding situation as above*

```{r}
log_all %>% 
  filter(response_id == "R_2R3c0sgWJSfIQJH") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

Raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_2R3c0sgWJSfIQJH")
```

**#22**    

*Same rounding situation as above*

```{r}
log_all %>% 
  filter(response_id == "R_vN3FAnuL9sdNsyJ") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

Raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_vN3FAnuL9sdNsyJ")
```



**#23**   

We recode start time from 4 AM to 4 PM, end time is also 4 PM.   

*John - I think this is probably reasonable but I don't know if it is too much of an assumption*    

Raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_3NCyjbdbUIcmj7R")
``` 

```{r}
log_all %>% 
  filter(response_id == "R_3NCyjbdbUIcmj7R") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```



**#24**    

Lapse reported from 12-20-18 9 AM to 12-20-18 Midnight. Survey is taking at 12:37 AM on 2018-12-21 so I think it is appropriate to change end date to 12-21-18. We also change start time to 9 PM though.    

*John - I flagged this to see if we could make this assumption for start time*    

Raw EMA
```{r}
ema_later %>% 
  filter(response_id == "R_tSUEclMc9TqDttv")
```

```{r}
log_all %>% 
  filter(response_id == "R_tSUEclMc9TqDttv") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```



**#25**   

*John - no changes needed on this one except to note that these may be unreliable non-lapses considering log notes below*   
```{r}
log_all %>% 
  filter(subid == "065" & 
           (response_id == "R_3fZsS5Dsiv4V8Us" | response_id == "R_1DqAtRHszCFO5RQ")) %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```


## Note entries

**1**   

Questionable lapse and non-lapses for subid 100        
```{r}
log_all %>% 
  filter(subid == "100" & response_id == "R_1hYI0TFdKUGdagV") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

EMAs
```{r}
ema_later %>% 
  filter(subid == "100") %>% 
  select(StartDate, EMAL_1, UTC) %>% 
  arrange(StartDate) %>% 
  filter(date(StartDate) >= "2018-08-10" & date(StartDate) <= "2018-08-12")
```

No lapses reported the morning of 8/11 or 8/12 either (no morning survey for 8-12)    

This makes me think they were drinking on 8/11, but we currently are using their lapse as 8/10    
```{r}
ema_morning %>% 
  filter(subid == "100") %>% 
  select(StartDate, EMAM_1, UTC) %>% 
  arrange(StartDate) %>% 
  filter(date(StartDate) >= "2018-08-10" & date(StartDate) <= "2018-08-12")
```


*John - below are note entries about incomplete lapses that were captured in another ema survey. Notes stemmed from subid data logs and I found more info on each of these. I am not sure if we want to do anything about these or just leave as is. Below is what I found.*     

**2**   

Overlapping lapse reports for subid 131   

EMA morning and later surveys for subid 131 
```{r}
ema_morning %>%  
  rename_with(~ str_replace(.x, "EMAM_", "EMA_")) %>% 
  filter(subid == "131" & date(StartDate) >= "2018-12-09" & 
           date(StartDate) <= "2018-12-11") %>% 
  bind_rows(ema_later %>% 
              rename_with(~ str_replace(.x, "EMAL_", "EMA_")) %>% 
              filter(subid == "131" & date(StartDate) >= "2018-12-09" & 
           date(StartDate) <= "2018-12-11")) %>% 
  arrange(StartDate) %>% 
  select(StartDate, EMA_1:EMA_1.4, UTC)
```

Do we want to keep the incomplete entry on 2018-12-10 which seems to be started in the middle of the lapse?    
Currently we just have a note in the log about this   
```{r}
log_all %>% 
  filter(response_id == "R_2fuMoTj6mLAJQPO") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```


**3**   

Another Incomplete lapse for subid 131   

EMA morning and later surveys for subid 131 
```{r}
ema_morning %>%  
  rename_with(~ str_replace(.x, "EMAM_", "EMA_")) %>% 
  filter(subid == "131" & date(StartDate) == "2018-11-30") %>% 
  bind_rows(ema_later %>% 
              rename_with(~ str_replace(.x, "EMAL_", "EMA_")) %>% 
              filter(subid == "131" & date(StartDate) == "2018-11-30")) %>% 
  arrange(StartDate) %>% 
  select(StartDate, EMA_1:EMA_1.4, UTC)
```

Do we want to keep the incomplete entry made at 4:34 PM?    
Currently we just have a note in the log about this   
```{r}
log_all %>% 
  filter(response_id == "R_cGSDB15GRJx2Pgl") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```



**4**   

Currently have an incomplete lapse for subid 158 that was captured the next day.   
```{r}
log_all %>% 
  filter(response_id == "R_W24Eoe0KBWOJ4Q1") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

EMA morning and later surveys for subid 158    


```{r}
ema_morning %>%  
  rename_with(~ str_replace(.x, "EMAM_", "EMA_")) %>% 
  filter(subid == "158" & date(StartDate) >= "2018-12-30" & 
           date(StartDate) <= "2018-12-31") %>% 
  bind_rows(ema_later %>% 
              rename_with(~ str_replace(.x, "EMAL_", "EMA_")) %>% 
                filter(subid == "158" & date(StartDate) >= "2018-12-30" & 
           date(StartDate) <= "2018-12-31")) %>% 
  arrange(StartDate) %>% 
  select(StartDate, EMA_1:EMA_1.4, UTC)
```


**5**   

Incomplete lapse for subid 178   

According to log the incomplete survey that reports a lapse was captured in the lapse prior. 
```{r}
log_all %>% 
  filter(response_id == "R_2dmR0Yn9S3nIlFn") %>% 
  kbl() %>% 
  kable_styling(bootstrap_options = c("condensed", "striped")) %>% 
  scroll_box(width = "100%")
```

EMA morning and later surveys for subid 178 
```{r}
ema_morning %>%  
  rename_with(~ str_replace(.x, "EMAM_", "EMA_")) %>% 
  filter(subid == "178" & date(StartDate) == "2019-1-25") %>% 
  bind_rows(ema_later %>% 
              rename_with(~ str_replace(.x, "EMAL_", "EMA_")) %>% 
              filter(subid == "178" & date(StartDate) == "2019-1-25")) %>% 
  arrange(StartDate) %>% 
  select(StartDate, EMA_1:EMA_1.4, UTC)
```

 
