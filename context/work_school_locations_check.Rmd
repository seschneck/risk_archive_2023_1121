---
title: "Review and resolution of each participants work/school locations"
author: "Hannah Moshontz"
date: '`r format(Sys.time(), "%Y-%m-%d")`'
output: 
  html_document:
    toc: true 
    toc_depth: 4
editor_options: 
  chunk_output_type: console
knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_dir = "P:/studydata/risk/knits/context")
  })
---


### Notes

Purpose: This file reviews each person's GPS data to resolve issues related to multiple work and school locations.

Inputs:  user_locations_check.csv, which is a copy of a sheet in "workbook_sent_from_xinyi.xlsx" with cleaned variable names. Many of the columns we will not use (the binary description and decision columns Xinyi created), but many contain information about activity zones that we do not otherwise have.


### Setup

Packages and Source
```{r, message = FALSE, warning = FALSE}
library(tidyverse)
library(janitor)
library(purrr)
library(kableExtra)
library(tidylog)
```

### Import file

```{r}
location_descriptions <- read_csv("./context/user_locations_check.csv",
                            col_names = TRUE) %>% 
  clean_names("snake") %>% 
  glimpse()

locations <- read_csv("./user_locations.csv",
                      col_names = TRUE) %>% 
  clean_names("snake") %>% 
  glimpse()

gps <- read_rds("P:/studydata/risk/data_processed/shared/gps.rds") %>% 
  glimpse()

```


### Merge

```{r}

location_check <- gps %>% 
  select(lat, lon, time, subid) %>% 
  group_by(subid) %>% 
  nest() %>% 
  left_join(
    select(
      location_descriptions,
      subid, type, n_home_locations, n_work_locations, 
      n_home_zones = n_home_zone, n_work_zones), 
    by = "subid") %>% 
  rename(gps_data = data)


#check for rows only in gps
unique(location_check$subid) %in% unique(gps$subid)

#check for duplicate rows in location_check
location_check %>% 
  group_by(subid) %>% 
  count() %>% 
  filter(n > 1)

#clean up
rm(gps)

```
