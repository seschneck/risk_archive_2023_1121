The scripts in this folder are used to create features for the lag study.  Follow these steps

1. Edit `lead_hours` and `version` in both `mak_jobs.R` and `mak_features_chtc.R`

2. Run `mak_jobs.R` in RStudio.  This will create a new folder on the server that contains the files needed to make features for a batch of jobs (i.e., for a specific lag).  These files are saved in an appropriately named folder on the server at `studydata/risk/chtc/lag/features/[batchname]`. There are subfolders for `input` and `output`.

3. FTP to CTHC and transfer all the files from the input folder to CHTC.

4. SSH to CHTC and run `features.sub` (`condor_submit features.sub`)

5. Monitor the jobs using `condor_q` (see docs in CHTC unit in `docs_arc` for more details.)

6. When the jobs have all completed, check that all the output is there and that there were no errors
  - Check that the correct number of feature files exist: `ls features*.csv | wc -l` 
  - Confirm that all error files are empty/0k in size: `ls error/error_* -lSr` will sort from smallest to largest so you can easily see any non-zero files.  Investigate contents if they exist. 

7. Combine individual feature files into one aggregate file: `batch_features.csv`.  Use this command: `head -n +1 features_*_1_300.csv > batch_features.csv; ls features*.csv | xargs awk 'FNR>1' >> batch_features.csv`

8.  FTP `batch_features.csv` back to server in the output folder.  FTP the job log file back to the output folder as well.

YAY!
